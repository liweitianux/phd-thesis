%%
%% Copyright (c) 2018-2019 Weitian LI <liweitianux@sjtu.edu.cn>
%% Creative Commons BY 4.0
%%

% 模板选项：
%   bachelor|master|doctor  % 必选项
%   fontset=fandol|adobe|windows
%   oneside|twoside
%   openany|openright
%   zihao=-4|5  % 正文字号: 小四（硕士/博士）、五号（学士）
%   english  % 启用英文模版
%   review  % 盲审论文，隐去作者姓名、学号、导师姓名、致谢、发表论文和参与的项目
%   submit  % 定稿提交的论文，插入签名扫描版的原创性声明和授权声明
\documentclass[
  doctor,
  openright,
  twoside,
  %review,
]{sjtuthesis}

\usepackage{xspace}
\usepackage{microtype}
\usepackage{fontawesome5}

\defaultfontfeatures{Mapping=tex-text}
\setmainfont{Source Serif Pro}
\setsansfont{Source Sans Pro}
\setmonofont{Source Code Pro}
\setmathfont{Asana Math}

\setCJKmainfont{Source Han Serif SC}
\setCJKsansfont{FandolKai}
\setCJKmonofont{FandolFang}

\graphicspath{{./}{figures/}{figures/self/}}

% biblatex
% Credit: http://www.khirevich.com/latex/biblatex/
\ExecuteBibliographyOptions{
  backref=true,
  mincitenames=1,
  maxcitenames=2,
}
% print author names as small caps
\renewcommand{\mkbibnamegiven}[1]{\textsc{#1}}
\renewcommand{\mkbibnamefamily}[1]{\textsc{#1}}
\renewcommand{\mkbibnameprefix}[1]{\textsc{#1}}
\renewcommand{\mkbibnamesuffix}[1]{\textsc{#1}}
% period after the authors
\renewcommand{\labelnamepunct}{\addperiod\space}
% discard the period at the very end of a record
\renewcommand{\finentrypunct}{}
% discard the period after the doi link
\renewcommand{\newunitpunct}{\addspace\midsentence}
% use lowercase English for backref
\DefineBibliographyStrings{english}{%
  backrefpage  = {\lowercase{s}ee p.}, % for single page number
  backrefpages = {\lowercase{s}ee pp.} % for multiple page numbers
}
\DeclareDelimFormat{finalnamedelim}{\addspace\&\space}
\DeclareFieldFormat[book]{title}{\textbf{#1}\addperiod\space}
\DeclareFieldFormat[article,inproceedings]{title}{\textit{#1}\addperiod\space}
\DeclareFieldFormat[inproceedings]{booktitle}{\textit{#1}\addperiod\space}
\DeclareFieldFormat[article,inproceedings]{volume}{\textbf{#1}\addcolon\space}
\DeclareFieldFormat{pages}{#1\addperiod\space}
%
\newcommand{\citeay}[1]{\citeauthor{#1} \citeyear{#1} \parencite{#1}}
\newcommand{\citet}[1]{\citeauthor{#1} (\citeyear{#1})\cite{#1}}

% Change 'emph' style to bold face
\let\emph\relax  % there's no \RedeclareTextFontCommand
\DeclareTextFontCommand{\emph}{\boldmath\bfseries}

% Use sans-serif for URLs by '\url'
\urlstyle{sf}

% Continuous footnote numbering
\counterwithout{footnote}{chapter}

% Set labels for hyperref's '\autoref'
% Credit: https://tex.stackexchange.com/a/66150
\def\equationautorefname~#1\null{式~(#1)\null}
\def\chapterautorefname~#1\null{第{#1}章\null}
\def\appendixautorefname{附录}
\def\sectionautorefname{\textsection}
\def\subsectionautorefname{\textsection}
\def\figureautorefname{图}
\def\tableautorefname{表}

% Custom commands
\newcommand{\doi}[1]{%
  \textsc{doi}: \href{https://doi.org/#1}{#1}}
\newcommand{\ads}[1]{%
  \textsc{ads}: \href{http://adsabs.harvard.edu/abs/#1}{#1}}
\newcommand{\arxiv}[1]{%
  arXiv: \href{https://arixv.org/abs/#1}{#1}}
\newcommand{\email}[1]{%
  \href{mailto:#1}{\texttt{#1}}}
%
\newcommand{\Cpi}{\symup{\pi}}  % constant pi
\newcommand{\Ce}{\symup{e}}  % constant e
\newcommand{\Ci}{\symup{i}}  % complex i
\newcommand{\R}[1]{\mathrm{#1}}  % text math alphabets
\newcommand{\B}[1]{\symbf{#1}}  % single-letter bold math
\newcommand{\V}[1]{\symbfit{#1}}  % bold italic
\newcommand{\M}[1]{\symbfsf{#1}}  % bold sans-serif (matrix)
\newcommand{\D}[1]{\R{d}#1}
\newcommand{\diff}[2]{\frac{\D{#1}}{\D{#2}}}
\newcommand{\pdiff}[2]{\frac{\partial #1}{\partial #2}}
%
\newcommand{\lcdm}{ΛCDM\xspace}

% New math operators
\DeclareMathOperator{\erf}{erf}
\DeclareMathOperator{\sinc}{sinc}

% siunitx settings and new units
\sisetup{
  range-phrase=\text{--},
  range-units=single,
  product-units=repeat,
  list-separator={, },
  list-final-separator={, and },
  separate-uncertainty=true,
  detect-all,  % detecting fonts
}
%
\DeclareSIUnit\arcsec{arcsec}
\DeclareSIUnit\arcmin{arcmin}
\DeclareSIUnit\cMpc{cMpc}  % comoving Mpc
\DeclareSIUnit\cGpc{cGpc}  % comoving Gpc
\DeclareSIUnit\deg{deg}
\DeclareSIUnit\dyne{dyn}
\DeclareSIUnit\erg{erg}
\DeclareSIUnit\esu{esu}
\DeclareSIUnit\franklin{Fr}
\DeclareSIUnit\gauss{G}
\DeclareSIUnit\hubble{\ensuremath{\mathit{h}}}
\DeclareSIUnit\jansky{Jy}
\DeclareSIUnit\lightyear{ly}
\DeclareSIUnit\parsec{pc}
\DeclareSIUnit\rayleigh{Rayleigh}
\DeclareSIUnit\solarmass{\ensuremath{\mathrm{M}_{\odot}}}
\DeclareSIUnit\statcoulomb{statC}
\DeclareSIUnit\year{yr}
%
\DeclareSIUnit\kpc{\kilo\parsec}
\DeclareSIUnit\mJy{\milli\jansky}
\DeclareSIUnit\mK{\milli\kelvin}
\DeclareSIUnit\Gpc{\giga\parsec}
\DeclareSIUnit\Gyr{\giga\year}
\DeclareSIUnit\Mpc{\mega\parsec}
\DeclareSIUnit\Myr{\mega\year}
\DeclareSIUnit\uG{\micro\gauss}

\usepackage[en-US]{datetime2}

\usepackage{journalabbrv}

\usepackage{acro}  % acronyms, symbols, glossaries
\acsetup{
  list-heading=chapter,
  extra-style=bracket,
  extra-format={\itshape},
}
\input{src/symbol.tex}
\input{src/acronym.tex}
\input{src/glossary.tex}

\AtBeginBibliography{
  \linespread{1.1}
  \small
}
\addbibresource{references.bib}


%=====================================================================

\DTMsavenow{defensedate}
%\DTMsavedate{defensedate}{2019-06-03}  % TODO

% 不得超过 36 字
\title{%
  SKA EoR 探测实验的射电晕前景建模以及\texorpdfstring{\\}{ }%
  EoR 信号分离算法的研究%
}
\keywords{% <=5 个
  低频射电天文,
  再电离时期,
  射电晕,
  微弱信号分离,
  深度学习
}
\author{李维天}
\studentnumber{0130729026}
\advisor{徐海光~教授}
\school{上海交通大学}
\institute{物理与天文学院}
\major{物理学}
\defensedate{%
  \DTMfetchyear{defensedate} 年
  \DTMfetchmonth{defensedate} 月
  \DTMfetchday{defensedate} 日}

\englishtitle{%
  A Study of Foreground Modeling of Radio Halos and \\
  EoR Signal Separation Method for the \\
  SKA EoR Experiment
}
\englishkeywords{%
  low-frequency radio astronomy,
  epoch of reionization,
  radio halos,
  weak signal separation,
  deep learning
}
\englishauthor{\textbf{Weitian Li}}
\englishadvisor{Prof.~\textbf{Haiguang Xu}}
\englishinstitute{School of Physics and Astronomy}
\englishschool{Shanghai Jiao Tong University}
\englishlocation{Shanghai, China}
\englishmajor{Physics}
\englishdate{\DTMusedate{defensedate}}

%---------------------------------------------------------------------
% Copyright @ last page
%
% Date format: yyyy.mm.dd
\newcommand*{\twodigits}[1]{\ifnum#1<10 0\fi\the#1}
\renewcommand*{\today}{%
  \leavevmode\hbox{\the\year.\twodigits\month.\twodigits\day}%
}
\newcommand*{\ccLabel}[2]{%
  \href{https://creativecommons.org/licenses/#1/#2/}{%
    \color{gray}\faCreativeCommons{}~\uppercase{#1}~#2}%
}
\newcommand*{\githubLabel}[2]{%
  \href{http://github.com/#1/#2}{%
    \color{gray}\faGithub{}~#1/#2}%
}
%
\fancypagestyle{lastpage}{
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \fancyfoot[L]{\color{gray}\footnotesize%
    \faCopyright{} 2018--2019, Weitian Li \& Haiguang Xu \hspace{0.5em}
    \ccLabel{by}{4.0} \hspace{0.5em}
    \githubLabel{liweitianux}{phd-thesis} \hspace{0.5em}
    \faEdit{} \today
  }
}
\AtEndDocument{%
  \label{doc:lastpage}
  %\ifodd\pageref{doc:lastpage}
    \newpage\mbox{}
    \thispagestyle{lastpage}
  %\fi
}


%=====================================================================
\begin{document}

\maketitle

\makeatletter
\ifsjtu@submit\relax
  \includepdf{scans/originality.pdf}
  \pdfbookmark[0]{\sjtu@label@originality}{originality}
  \cleardoublepage
  \includepdf{scans/authorization.pdf}
  \pdfbookmark[0]{\sjtu@label@authorization}{authorization}
  \cleardoublepage
\else
  \makeDeclareOriginality
  \makeDeclareAuthorization
\fi
\makeatother

%---------------------------------------------------------------------
\frontmatter

\include{src/abstract}

\tableofcontents
\listoffigures
\listoftables

\acsetup{list-style=longtable}
\printacronyms[
  include-classes=symbol,
  name={主要符号对照表},
]

%---------------------------------------------------------------------
\mainmatter
\pagestyle{main}

\include{src/chap-introduction}
\include{src/chap-radio-astro}
\include{src/chap-detection}
\include{src/chap-simulation}
\include{src/chap-halo}
\include{src/chap-cdae}
\include{src/summary}

\appendix

\include{src/app-formulas}
\include{src/app-units}
\include{src/app-fpsolver}
\include{src/app-halos}

%---------------------------------------------------------------------
\backmatter

\printbibliography[heading=bibintoc]

\newlist{acronymlist}{description}{1}
\setlist[acronymlist]{
  noitemsep,
  itemindent=0pt,
  labelindent=0pt,
  labelwidth=8em,
  leftmargin=9em,
}
\DeclareAcroListStyle{myacronym}{list}{list=acronymlist}
\acsetup{
  list-style=myacronym,
  page-style=paren,
}
\printacronyms[
  include-classes=acronym,
  name={主要缩略语对照表},
]
\printacronyms[
  include-classes=glossary,
  name={主要术语汉英对照表},
]

\makeatletter
\ifsjtu@review\relax
  % Excluded for review
\else
  \include{src/acknowledgments}
\fi
\ifsjtu@bachelor
  % 本科学位论文要求在最后有一个英文大摘要，单独编页码
  \pagestyle{biglast}
  \include{src/app-abstract}
\else
  \include{src/publications}
  % \include{src/projects}
  % \include{src/patents}
  \ifsjtu@review\relax\else
    \include{src/resume}
  \fi
\fi
\makeatother

\end{document}
